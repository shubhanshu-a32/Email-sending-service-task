# ğŸ“¬ Resilient Email Sending Service

A fault-tolerant and smart email delivery microservice using Node.js, featuring:

- **Retry logic**
- **Provider fallback**
- **Idempotency**
- **Rate limiting**
- **Circuit breaker**
- **Status tracking**
- **Mock Providers**

---

## ğŸ“ Project Structure

```
.
â”œâ”€â”€ server.js                  # Express server + routes
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ EmailService.js        # Core logic (retry, fallback, etc.)
â”‚   â””â”€â”€ providers/
â”‚       â”œâ”€â”€ MockProviderA.js   # Simulates email provider A
â”‚       â””â”€â”€ MockProviderB.js   # Simulates email provider B
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ rateLimiter.js         # In-memory rate limiter
â”‚   â””â”€â”€ logger.js              # Console logger
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ EmailService.test.js   # Jest unit tests
â”œâ”€â”€ .env                       # Environment variables (PORT)
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸš€ Features

| Feature             | Description                                                            |
|---------------------|------------------------------------------------------------------------|
| ğŸ” Retry Logic      | Retries failed requests up to 3 times with exponential backoff          |
| ğŸ”„ Fallback         | Switches to a secondary provider if the primary fails                   |
| ğŸ§  Idempotency      | Prevents duplicate sends using request hashing                          |
| ğŸ›¡ï¸ Rate Limiting   | 5 requests per minute per user (in-memory limiter)                      |
| âš¡ Circuit Breaker   | Temporarily disables failing providers after multiple failures          |
| ğŸ“ˆ Status Tracking  | Track status of each request via `/status/:id` endpoint                 |
| ğŸ§ª Unit Tested      | Includes tests for retry, fallback, rate-limiting, etc. (Jest)          |

---

## ğŸ› ï¸ Tech Stack

- Node.js + Express.js
- JavaScript (ES6+)
- Jest (Testing)
- uuid (Request ID generation)
- dotenv (Env config)

---

## âš™ï¸ Setup Instructions

1. **Clone the Repository**
   ```sh
   git clone (https://github.com/shubhanshu-a32/Email-sending-service-task.git)
   cd email-service
   ```

2. **Install Dependencies**
   ```sh
   npm install
   ```

3. **Run the Server**
   ```sh
   node server.js
   ```
   Server runs on: [http://localhost:3000](http://localhost:3000)

---

## ğŸ“® API Endpoints

### POST `/send-email`

Send an email using provider A or fallback B with retry, rate limit, etc.

**Request Body:**
```json
{
  "to": "user@example.com",
  "subject": "Hello",
  "body": "This is a test email",
  "userId": "user123",
  "requestId": "req-001" // optional, autogenerated if omitted
}
```

**Response:**
```json
{
  "requestId": "req-001",
  "status": "sent",
  "provider": "A"
}
```
Other possible statuses: `"duplicate"`, `"rate_limited"`, `"failed"`

---

### GET `/status/:requestId`

Check status of a specific email send request.

**Example:**
```sh
GET http://localhost:3000/status/req-001
```

**Response:**
```json
{
  "status": "sent",
  "provider": "A",
  "at": 1720612320000
}
```

---

## ğŸ§ª Running Tests

Run all tests with:

```sh
npm test
```

Tests include:

- Retry logic
- Duplicate request prevention
- Rate limiting
- Status tracking

---

## ğŸ¤– Mock Email Providers

- **Provider A:** 70% success rate
- **Provider B:** 90% success rate

Providers randomly fail to trigger retry and fallback logic.

---

## âœ¨ Sample Postman Request

```http
POST http://localhost:3000/send-email
Content-Type: application/json

{
  "to": "test@domain.com",
  "subject": "Welcome",
  "body": "This is a test email",
  "userId": "user123"
}
```

---

## ğŸ™‹ Author & Credits

Made with ğŸ’™ by Shubhanshu Upadhyay with ChatGPT also.
Backend Developer Trainee Assignment â€“ PearlThoughts

---

## ğŸ“„ License

This project is open-source and free to use under the MIT