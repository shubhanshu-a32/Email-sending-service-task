# 📬 Resilient Email Sending Service

A fault-tolerant and smart email delivery microservice using Node.js, featuring:

- **Retry logic**
- **Provider fallback**
- **Idempotency**
- **Rate limiting**
- **Circuit breaker**
- **Status tracking**
- **Mock Providers**

---

## 📁 Project Structure

```
.
├── server.js                  # Express server + routes
├── services/
│   ├── EmailService.js        # Core logic (retry, fallback, etc.)
│   └── providers/
│       ├── MockProviderA.js   # Simulates email provider A
│       └── MockProviderB.js   # Simulates email provider B
├── utils/
│   ├── rateLimiter.js         # In-memory rate limiter
│   └── logger.js              # Console logger
├── tests/
│   └── EmailService.test.js   # Jest unit tests
├── .env                       # Environment variables (PORT)
├── package.json
└── README.md
```

---

## 🚀 Features

| Feature             | Description                                                            |
|---------------------|------------------------------------------------------------------------|
| 🔁 Retry Logic      | Retries failed requests up to 3 times with exponential backoff          |
| 🔄 Fallback         | Switches to a secondary provider if the primary fails                   |
| 🧠 Idempotency      | Prevents duplicate sends using request hashing                          |
| 🛡️ Rate Limiting   | 5 requests per minute per user (in-memory limiter)                      |
| ⚡ Circuit Breaker   | Temporarily disables failing providers after multiple failures          |
| 📈 Status Tracking  | Track status of each request via `/status/:id` endpoint                 |
| 🧪 Unit Tested      | Includes tests for retry, fallback, rate-limiting, etc. (Jest)          |

---

## 🛠️ Tech Stack

- Node.js + Express.js
- JavaScript (ES6+)
- Jest (Testing)
- uuid (Request ID generation)
- dotenv (Env config)

---

## ⚙️ Setup Instructions

1. **Clone the Repository**
   ```sh
   git clone (https://github.com/shubhanshu-a32/Email-sending-service-task.git)
   cd email-service
   ```

2. **Install Dependencies**
   ```sh
   npm install
   ```

3. **Run the Server**
   ```sh
   node server.js
   ```
   Server runs on: [http://localhost:3000](http://localhost:3000)

---

## 📮 API Endpoints

### POST `/send-email`

Send an email using provider A or fallback B with retry, rate limit, etc.

**Request Body:**
```json
{
  "to": "user@example.com",
  "subject": "Hello",
  "body": "This is a test email",
  "userId": "user123",
  "requestId": "req-001" // optional, autogenerated if omitted
}
```

**Response:**
```json
{
  "requestId": "req-001",
  "status": "sent",
  "provider": "A"
}
```
Other possible statuses: `"duplicate"`, `"rate_limited"`, `"failed"`

---

### GET `/status/:requestId`

Check status of a specific email send request.

**Example:**
```sh
GET http://localhost:3000/status/req-001
```

**Response:**
```json
{
  "status": "sent",
  "provider": "A",
  "at": 1720612320000
}
```

---

## 🧪 Running Tests

Run all tests with:

```sh
npm test
```

Tests include:

- Retry logic
- Duplicate request prevention
- Rate limiting
- Status tracking

---

## 🤖 Mock Email Providers

- **Provider A:** 70% success rate
- **Provider B:** 90% success rate

Providers randomly fail to trigger retry and fallback logic.

---

## ✨ Sample Postman Request

```http
POST http://localhost:3000/send-email
Content-Type: application/json

{
  "to": "test@domain.com",
  "subject": "Welcome",
  "body": "This is a test email",
  "userId": "user123"
}
```

---

## 🙋 Author & Credits

Made with 💙 by Shubhanshu Upadhyay with ChatGPT also.
Backend Developer Trainee Assignment – PearlThoughts

---

## 📄 License

This project is open-source and free to use under the MIT